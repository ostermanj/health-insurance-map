!function(t,e){"use strict";"object"==typeof exports&&module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PubSub=e()}("object"==typeof window&&window||this,function(){"use strict";function t(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1}function e(t,e,n,i){var r,o=a[e],s=i?function(t,e,n){t(e,n)}:function(t,e,n){try{t(e,n)}catch(t){setTimeout(function(t){return function(){throw t}}(t),0)}};if(a.hasOwnProperty(e))for(r in o)o.hasOwnProperty(r)&&s(o[r],t,n)}function n(n,i,r,o){var s=function(t,n,a){return function(){var i=String(t),r=i.lastIndexOf(".");for(e(t,t,n,a);-1!==r;)r=(i=i.substr(0,r)).lastIndexOf("."),e(t,i,n)}}(n,i,o);return!!function(e){for(var n=String(e),i=Boolean(a.hasOwnProperty(n)&&t(a[n])),r=n.lastIndexOf(".");!i&&-1!==r;)r=(n=n.substr(0,r)).lastIndexOf("."),i=Boolean(a.hasOwnProperty(n)&&t(a[n]));return i}(n)&&(!0===r?s():setTimeout(s,0),!0)}var PubSub={},a={},i=-1;return PubSub.publish=function(t,e){return n(t,e,!1,PubSub.immediateExceptions)},PubSub.publishSync=function(t,e){return n(t,e,!0,PubSub.immediateExceptions)},PubSub.subscribe=function(t,e){if("function"!=typeof e)return!1;a.hasOwnProperty(t)||(a[t]={});var n="uid_"+String(++i);return a[t][n]=e,n},PubSub.unsubscribe=function(t){var e,n,i,r="string"==typeof t,o=!1;for(e in a)if(a.hasOwnProperty(e)){if(n=a[e],r&&n[t]){delete n[t],o=t;break}if(!r)for(i in n)n.hasOwnProperty(i)&&n[i]===t&&(delete n[i],o=!0)}return o},PubSub}),function t(e,n,a){function i(o,s){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n||t)},l,l.exports,t,e,n,a)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(t,e,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){mapboxgl.accessToken="pk.eyJ1Ijoib3N0ZXJtYW5qIiwiYSI6ImNpdnU5dHVndjA2eDYyb3A3Nng1cGJ3ZXoifQ.Xo_k-kzGfYX_Yo_RDcHDBg";var t={10:[[-75.794677734375,38.45358870894137],[-75.05859375,39.84228602074339]],11:[[-77.11990356445312,38.792091771584694],[-76.9097900390625,38.99570671505043]],12:[[-87.637939453125,24.51713945052515],[-80.035400390625,31.00586290462421]],13:[[-85.60546875,30.363396239603716],[-80.848388671875,35.00300339527672]],15:[[-161,18.48917],[-153,22.525]],16:[[-117.24609375,41.992160233376296],[-111.0498046875,49.00184391797853]],17:[[-91.51611328125,36.97622678464096],[-87.506103515625,42.51260171573665]],18:[[-88.099365234375,37.779398571318765],[-84.79248046875,41.76311744700587]],19:[[-96.646728515625,40.38002840251184],[-90.142822265625,43.5007524356904]],20:[[-102.052001953125,36.993778388725175],[-94.59228515625,40.01078714046551]],21:[[-89.571533203125,36.50080531760479],[-81.968994140625,39.15562239342324]],22:[[-94.053955078125,28.93124697186731],[-88.824462890625,33.027087580028734]],23:[[-71.08154296875,43.060861371343265],[-66.95068359375,47.46523622438363]],24:[[-79.4970703125,37.918201119766636],[-75.05859375,39.7240885773337]],25:[[-73.509521484375,41.244772343082076],[-69.93896484375,42.89206418807336]],27:[[-97.239990234375,43.5007524356904],[-89.49462890625,49.38952445158216]],28:[[-91.658935546875,30.18312184219552],[-88.099365234375,35.00300339527672]],29:[[-95.77880859375,35.99578538642032],[-89.09912109375,40.61395244116659]],30:[[-116.0595703125,44.36313311380772],[-104.04052734375,49.00184391797853]],31:[[-104.0625,40.00237193587648],[-95.3173828125,43.00464712779444]],32:[[-120.0146484375,35.00300339527672],[-114.049072265625,42.008489015723995]],33:[[-72.564697265625,42.69858589169843],[-70.7080078125,45.305802599435765]],34:[[-75.56396484375,38.93377552819723],[-73.89404296875,41.36031866306709]],35:[[-109.05029296875,31.33487103395059],[-103.0078125,37.00255267215955]],36:[[-79.771728515625,40.497092372695676],[-71.861572265625,45.01918507438177]],37:[[-84.3310546875,33.852169701407405],[-75.465087890625,36.58906837139911]],38:[[-104.051513671875,45.93587062119053],[-96.558837890625,49.00184391797853]],39:[[-84.825439453125,38.41055825094608],[-80.52978515625,41.983994270935625]],40:[[-103.0078125,33.62376800118811],[-94.4384765625,37.00255267215955]],41:[[-124.56298828125,42.00032514831622],[-116.466064453125,46.27103747280262]],42:[[-80.52978515625,39.7240885773337],[-74.696044921875,42.2773087742371]],44:[[-71.87255859375,41.153842357114485],[-71.12548828125,42.02481360781778]],45:[[-83.353271484375,32.03602003973755],[-78.541259765625,35.21869749632886]],46:[[-104.0625,42.488301979602284],[-96.43798828125,45.951149686691394]],47:[[-90.318603515625,34.985003130171066],[-81.650390625,36.68604127658193]],48:[[-106.6552734375,25.83944940206318],[-93.526611328125,36.50080531760479]],49:[[-114.06005859375,37.00255267215955],[-109.05029296875,42.008489015723995]],50:[[-73.443603515625,42.73087427928485],[-71.466064453125,45.01918507438177]],51:[[-83.682861328125,36.544949441483226],[-75.245361328125,39.47012512235818]],53:[[-124.73876953125,45.544831492424635],[-116.91650390625,49.009050809382046]],54:[[-82.650146484375,37.204081555898526],[-77.728271484375,40.63896734381723]],55:[[-92.889404296875,42.49640294093706],[-86.81396484375,47.07760411715964]],56:[[-111.060791015625,41.0047754222295],[-104.0625,45.01141864227728]],72:[[-67.950439453125,17.88465917954281],[-65.225830078125,18.521283325496285]],"06":[[-124.4091796875,32.537551746769],[-114.136962890625,42.01665183556824]],"04":[[-114.818115234375,31.33487103395059],[-109.05029296875,37.00255267215955]],"08":[[-109.061279296875,36.993778388725175],[-102.052001953125,41.0047754222295]],"05":[[-94.625244140625,33.008663494575586],[-89.6484375,36.50080531760479]],"01":[[-88.48388671875,30.23059456493219],[-84.90234375,35.012002043160706]],"09":[[-73.729248046875,40.98819156349393],[-71.795654296875,42.05745022024681]],"02":[[-190.539,53.135],[-116,71.139]],26:[[-90.511,41.683],[-82.433,48.25]]},e={lower48:[[-125.94823224526017,24],[-65.43255594715713,50.05360024146327]],"02":t["02"],15:t[15]},n=10,i=[{container:"map-0",style:"mapbox://styles/mapbox/light-v9",bounds:[[-125.94823224526017,24],[-65.43255594715713,50.05360024146327]]},{container:"map-1",style:"mapbox://styles/mapbox/light-v9",bounds:"02"},{container:"map-2",style:"mapbox://styles/mapbox/light-v9",bounds:"15"}],r={promises:{},addSourceAndLayers:function(t,e){var n=this,a=t.name;r.promises[t.name]=new Promise(function(e){function i(){this.getSource(a)&&(e(!0),this.off("render",i))}delete t.name,n.on("render",i),n.addSource(a,t)});var i=[];return r.promises[a].then(function(){return e.forEach(function(t){i.push(new Promise(function(e){function i(){this.getLayer(t.id)&&(e(!0),this.off("render",i))}var r=t.beforeLayer?t.beforeLayer:"";delete t.beforeLayer,t.source=a,n.on("render",i),n.addLayer(t,r)}))}),Promise.all(i)})}},o={maps:[],init:function(){p([["activeStateFP",o.zoomInMapHandler],["activeMap",o.zoomInMapHandler],["activeStateFP",o.updateLegend],["legendScale",o.changeLegendScale],["holdCounty",o.holdCounty]]),this.wrapper=document.getElementById("map-view-wrapper"),this.el=document.getElementById("map-view"),this.checkMapViewAspect()},holdCounty:function(t,e){e?(o.maps.forEach(function(t){t.off("mousemove","counties",o.countyMouseMove),t.off("mouseleave","counties",o.countyMouseLeave),t.off("mouseup","counties",o.countyMouseUp)}),d3.select("#map-view-wrapper").on("mouseup",function(){2===d3.event.button&&c("holdCounty",!1)}),o.showMessage("&nbsp;Right click again to release selection&nbsp;")):(o.showMessage(""),o.countyMouseLeave(),o.maps.forEach(function(t){t.on("mousemove","counties",o.countyMouseMove),t.on("mouseleave","counties",o.countyMouseLeave),t.on("mouseup","counties",o.countyMouseUp)}),d3.select("#map-view-wrapper").on("mouseup",null))},showMessage:function(t){s.fadeInHTML.call(d3.select("#message"),function(){return t})},initializeMap:function(t,n,i){var r,o=t.container,s=t.style,u=t.bounds;if("object"===(void 0===u?"undefined":a(u)))r=u;else{if("string"!=typeof u)throw"bounds not corrct type: should be lng/lat array or string key to mapBounds object";r=e[u]}var c={container:o,style:s,maxBounds:r};this.maps[n]=new mapboxgl.Map(c),this.maps[n].originalOptions=t,this.maps[n].index=n,this.maps[n].on("load",function(){i(!0)})},resizeMaps:function(){this.maps.forEach(function(t){t.fitBounds(t.getMaxBounds())})},checkMapViewAspect:function(){var t=this.wrapper.offsetHeight,e=this.wrapper.offsetWidth;this.el.style.maxWidth=t<.813*e?1.23*t+"px":"100%"},setup:function(t){var e=this,a=t[0],i=t[1];o.countyDate=i,function(){var t=this;this.mapRange=function(t){for(var e=[],n=0;n<=t;n++)e.push(Math.round(10/t*n/10*100)/100);return e}(n-1),this.legendRange=[],this.mapRange.forEach(function(e,n,a){n%2!=0&&n!==a.length-1||t.legendRange.push(e)}),o.scaleState=d3.scaleQuantile().domain(a.map(function(t){return t.DP03_0099PE})).range(this.mapRange),o.scaleCounty=d3.scaleQuantile().domain(i.map(function(t){return t.DP03_0099PE})).range(this.mapRange),window.scaleState=o.scaleState,o.stateStops=[["0","rgb(100,100,100)"]],o.countyStops={string:[["0","rgb(100,100,100)"]],numeric:[[0,"rgb(100,100,100)"]]},a.forEach(function(t){var e=d3.interpolateYlOrBr(o.scaleState(t.DP03_0099PE));o.stateStops.push([t.state,e])}),i.forEach(function(t){var e=d3.interpolateYlOrBr(o.scaleCounty(t.DP03_0099PE));"0"===t.state[0]?o.countyStops.string.push([t.state+t.county,e]):o.countyStops.numeric.push([+(t.state+t.county),e])})}.call(this),function(){var t=this;this.legend=d3.select("#legend");var e=this.legend;e.append("h2").attr("class","legend-title").html("Percentage without health insurance");var n=e.selectAll("legendDiv").data(this.legendRange.slice(0,-1)).enter().append("div").attr("class","flex end");n.append("span").attr("class","legend-key").attr("style",function(e,n){return"background: "+d3.interpolateYlOrBr(e)+"; /* For browsers that do not support gradients */\n                                background: -webkit-linear-gradient("+d3.interpolateYlOrBr(e)+", "+d3.interpolateYlOrBr(t.legendRange[n+1])+"); /* For Safari 5.1 to 6.0 */\n                                background: -o-linear-gradient("+d3.interpolateYlOrBr(e)+", "+d3.interpolateYlOrBr(t.legendRange[n+1])+"); /* For Opera 11.1 to 12.0 */\n                                background: -moz-linear-gradient("+d3.interpolateYlOrBr(e)+", "+d3.interpolateYlOrBr(t.legendRange[n+1])+"); /* For Firefox 3.6 to 15 */\n                                background: linear-gradient(to right, "+d3.interpolateYlOrBr(e)+" , "+d3.interpolateYlOrBr(t.legendRange[n+1])+");"}),this.legendSpans=n.append("span"),this.updateLegend()}.call(this),o.maps.forEach(function(t){e.sharedMapSetup(t)})},updateLegend:function(t,e){"activeStateFP"===t&&null!==e&&"null"!==e?c("legendScale","county"):c("legendScale","state")},changeLegendScale:function(t,e){d3.select("#legend").node().parentNode.classList.remove("load-finished");var n="county"===e?o.scaleCounty:o.scaleState;s.fadeInHTML.call(o.legendSpans,function(t,e){return'<span class="legend-item-min">'+d3.format(",.1f")(n.invertExtent(t)[0])+'</span>&ndash;<span class="legend-item-max">'+d3.format(",.1f")(n.invertExtent(o.mapRange[2*e+1])[1])+"</span>"}),d3.select("#legend").node().parentNode.classList.add("load-finished")},setOriginalCenterAndZoom:function(t){t.originalCenter=t.getCenter(),t.originalZoom=t.getZoom()},sharedMapSetup:function(t){t.dragRotate.disable(),t.touchZoomRotate.disableRotation(),o.setOriginalCenterAndZoom(t),t.getStyle().layers.filter(function(t){return"road"===t["source-layer"]}).forEach(function(e){t.setPaintProperty(e.id,"line-opacity",.2)}),r.addSourceAndLayers.call(t,{type:"vector",url:"mapbox://mapbox.us_census_states_2015",name:"states"},[{id:"states-join",type:"fill","source-layer":"states",paint:{"fill-color":"transparent"},beforeLayer:"water"},{id:"states-join-hover",type:"line","source-layer":"states",paint:{"line-color":"#4D90FE","line-width":4,"line-blur":2},filter:["==","name",""]}]).then(function(){r.addSourceAndLayers.call(t,{type:"vector",url:"mapbox://mapbox.82pkq93d",name:"counties"},[{id:"counties",type:"fill",source:"counties","source-layer":"original",paint:{"fill-outline-color":"rgba(255,255,255,0.5)","fill-color":"transparent"},beforeLayer:"water",filter:["==","FIPS",""]},{id:"counties-hover",type:"line",source:"counties","source-layer":"original",paint:{"line-color":"#584dfe","line-width":4,"line-blur":2},beforeLayer:"water",filter:["==","FIPS",""]}]).then(function(){o.stateFillActive={property:"STATEFP",type:"categorical",stops:o.stateStops},o.stateFillInactive="#959595",o.countyFill={property:"FIPS",type:"categorical",stops:o.countyStops.string},t.setPaintProperty("states-join","fill-color",o.stateFillActive),t.on("mousemove","states-join",function(e){t.setFilter("states-join-hover",["==","STATEFP",e.features[0].properties.STATEFP])}),t.on("mouseleave","states-join",function(){t.setFilter("states-join-hover",["==","STATEFP",""])}),t.on("click","states-join",function(e){c("activeMap",t.index),l("activeStateFP")!==e.features[0].properties.STATEFP?c("activeStateFP",e.features[0].properties.STATEFP):c("activeStateFP",null)}),d3.select("#"+t.originalOptions.container+" .load-overlay").classed("load-finished",!0)})})},zoomInMapHandler:function(e,n){function a(){this.off("zoomend",a),this.flyTo({center:this.originalCenter})}function i(t){var e=o.maps[t];e.setFilter("counties",["==","FIPS",""]),e.setFilter("counties-hover",["==","FIPS",""]),e.index>0&&e.on("zoomend",a),e.fitBounds(e.getMaxBounds()),o.maps.forEach(function(t){t.setPaintProperty("states-join","fill-color",o.stateFillActive)})}function r(t){return"0"===t[0]?{min:"0"+1e3*+t.slice(0,2),max:"0"+(1e3*+t.slice(0,2)+999)}:{min:1e3*+t.slice(0,2),max:1e3*+t.slice(0,2)+999}}c("holdCounty",!1),"activeStateFP"===e&&(null===n||"null"===n?i(l("activeMap")):function(){var e=o.maps[l("activeMap")];"0"===n[0]?e.setPaintProperty("counties","fill-color",{property:"FIPS",type:"categorical",stops:o.countyStops.string}):e.setPaintProperty("counties","fill-color",{property:"FIPS",type:"categorical",stops:o.countyStops.numeric}),o.maps.forEach(function(t){t.setPaintProperty("states-join","fill-color",o.stateFillInactive)}),e.index>0&&e.on("zoomend",a);var i=0===e.index?30:0;e.fitBounds(t[n],{padding:i}),e.setFilter("counties",["all",[">","FIPS",r(n).min],["<=","FIPS",r(n).max]]),e.on("mousemove","counties",o.countyMouseMove),e.on("mouseleave","counties",o.countyMouseLeave),e.on("mouseup","counties",o.countyMouseUp),e.getZoom()<2&&e.setZoom(2)}()),"activeMap"===e&&void 0!==f("activeMap")&&i(f("activeMap"))},countyMouseUp:function(t){2===t.originalEvent.button&&c("holdCounty",!0)},countyMouseMove:function(t){o.mousemoveFilter(t,o.highlightCounty)},mousemoveFilter:function(t,e){o.mousemoveActive&&o.mousemoveActive===t.features[0].id||(o.mousemoveActive=t.features[0].id,e(t))},highlightCounty:function(t){o.maps[l("activeMap")].setFilter("counties-hover",["==","FIPS",t.features[0].properties.FIPS]),o.showMessage("&nbsp;Right click to hold selection&nbsp;"),Promise.all([u.promises.dictionary,u.promises.countyDetails]).then(function(e){s.handleCharts(e,t.features[0].properties.FIPS)})},countyMouseLeave:function(){o.maps[l("activeMap")].setFilter("counties-hover",["==","FIPS",""]),o.showMessage(""),o.mousemoveActive=null,s.getStateDetails("activeStateFP",l("activeStateFP"))}},s={fadeInHTML:function(t){this.transition().duration(s.duration/2).ease(d3.easeCubicOut).style("opacity",0).on("end",function(e,n){var a=d3.select(this);a.html(function(){return t(e,n)}),a.transition().duration(s.duration/2).ease(d3.easeCubicOut).style("opacity",1)})},duration:500,transition:d3.transition().duration(500).ease(d3.easeCubicOut),chartsAreCreated:!1,initializeDropdown:function(t){p([["activeStateFP",function(t,e){d3.select("#state-selector").node().value=e}],["activeStateFP",this.getStateDetails]]),d3.select("#state-selector").node().onchange=function(){var t=this,e=o.maps.find(function(e){return e.originalOptions.bounds===t.value}),n=e?e.index:0;c("activeMap",n),c("activeStateFP",this.value)},d3.select("#state-selector").selectAll("stateOptions").data(t).enter().append("option").attr("value",function(t){return t.state}).text(function(t){return t.NAME}),d3.select("#dropdown-div").classed("load-finished",!0)},getStateDetails:function(t,e){d3.select("#sidebar-bottom").classed("load-finished",!1),void 0===u.promises.dictionary&&(u.promises.dictionary=u.returnData("data/data-dictionary.json",null,!1)),void 0===u.promises.countyDetails&&(u.promises.countyDetails=u.returnACSData("https://api.census.gov/data/2015/acs/acs5/profile?get=DP03_0095E,DP03_0095PE,DP03_0096E,DP03_0096PE,DP03_0097E,DP03_0097PE,DP03_0098E,DP03_0098PE,DP03_0099E,DP03_0099PE,DP03_0100E,DP03_0100PE,DP03_0101E,DP03_0101PE,DP03_0102E,DP03_0102PE,DP03_0103E,DP03_0103PE,DP03_0104E,DP03_0104PE,DP03_0105E,DP03_0105PE,DP03_0106E,DP03_0106PE,DP03_0107E,DP03_0107PE,DP03_0108E,DP03_0108PE,DP03_0109E,DP03_0109PE,DP03_0110E,DP03_0110PE,DP03_0111E,DP03_0111PE,DP03_0112E,DP03_0112PE,DP03_0113E,DP03_0113PE,DP03_0114E,DP03_0114PE,DP03_0115E,DP03_0115PE,DP03_0116E,DP03_0116PE,DP03_0117E,DP03_0117PE,DP03_0118E,DP03_0118PE,NAME&for=county:*&key=",function(t){return t.state+t.county})),e&&"null"!==e?(void 0===u.promises.stateDetails&&(u.promises.stateDetails=u.returnACSData("https://api.census.gov/data/2015/acs/acs5/profile?get=DP03_0095E,DP03_0095PE,DP03_0096E,DP03_0096PE,DP03_0097E,DP03_0097PE,DP03_0098E,DP03_0098PE,DP03_0099E,DP03_0099PE,DP03_0100E,DP03_0100PE,DP03_0101E,DP03_0101PE,DP03_0102E,DP03_0102PE,DP03_0103E,DP03_0103PE,DP03_0104E,DP03_0104PE,DP03_0105E,DP03_0105PE,DP03_0106E,DP03_0106PE,DP03_0107E,DP03_0107PE,DP03_0108E,DP03_0108PE,DP03_0109E,DP03_0109PE,DP03_0110E,DP03_0110PE,DP03_0111E,DP03_0111PE,DP03_0112E,DP03_0112PE,DP03_0113E,DP03_0113PE,DP03_0114E,DP03_0114PE,DP03_0115E,DP03_0115PE,DP03_0116E,DP03_0116PE,DP03_0117E,DP03_0117PE,DP03_0118E,DP03_0118PE,NAME&for=state:*&key=","state")),Promise.all([u.promises.dictionary,u.promises.stateDetails,u.promises.countyDetails]).then(function(t){s.handleCharts(t)})):Promise.all([u.promises.dictionary,u.promises.USDetails,u.promises.countyDetails]).then(function(t){s.handleCharts(t,"US")})},handleCharts:function(t,e){function n(){s.countyLabel.datum(i),s.fadeInHTML.call(s.countyLabel,function(t){return"United States"!==t.NAME?t.NAME.replace(/,.*/,""):"&nbsp;"})}function a(){"US"===e&&n(),s.nested.forEach(function(t){s[t.key+"-without"].interrupt().on("mouseover",function(t){s.showData(t,i[t.variable.replace("E","PE")],i[t.variable],"left")}).transition(s.transition).attr("transform",function(t){return"translate("+(s.scale(s.maxWithout)-s.scale(i[t.variable.replace("E","PE")]))+", 0)"}).attr("width",function(t){return s.scale(i[t.variable.replace("E","PE")])}),void 0!==t.values.find(function(t){return"private"===t.type})?(s[t.key+"-pub"].interrupt().on("mouseover",function(t){s.showData(t,i[t.variable.replace("E","PE")],i[t.variable])}).transition(s.transition).attr("transform",function(){var e=i[t.values.find(function(t){return"public"===t.type}).variable.replace("E","PE")],n=i[t.values.find(function(t){return"with"===t.type}).variable.replace("E","PE")];return"translate("+(s.scale(s.maxWithout)+s.scale(n-e))+", 0)"}).attr("width",function(t){return s.scale(i[t.variable.replace("E","PE")])}),s[t.key+"-priv"].interrupt().on("mouseover",function(t){s.showData(t,i[t.variable.replace("E","PE")],i[t.variable])}).transition(s.transition).attr("width",function(t){return s.scale(i[t.variable.replace("E","PE")])})):s[t.key+"-unspecified"].interrupt().on("mouseover",function(t){s.showData({label:"With public or private insurance"},100-i[t.variable.replace("E","PE")])}).transition(s.transition).attr("width",function(t){return s.scale(100-i[t.variable.replace("E","PE")])})}),d3.select("#sidebar-bottom").classed("load-finished",!0)}var i,r=t[0],o=t[2]?t[2]:null;if(e?"US"===e?i=t[1][0]:(i=t[1][e][0],n()):(t[1][l("activeStateFP")],i=t[1][l("activeStateFP")][0],s.fadeInHTML.call(s.countyLabel,function(){return"&nbsp;"})),this.chartsAreCreated)a();else{var u=r.filter(function(t){return"without"===t.type&&-1!==t.variable.indexOf("PE")}).map(function(t){return t.variable}),c=r.filter(function(t){return"with"===t.type&&-1!==t.variable.indexOf("PE")}).map(function(t){return t.variable}),f=[[],[]];Object.keys(o).forEach(function(t){u.map(function(e){f[0].push(+o[t][0][e])}),c.map(function(e){f[1].push(+o[t][0][e])})}),s.maxWithout=d3.max(f[0]),s.maxWith=d3.max(f[1]),function(){s.definitionsLeft=d3.select("#sidebar-definitions #left"),s.definitionsRight=d3.select("#sidebar-definitions #right"),s.countyLabel=d3.select("#county-label").datum(i);var t=s.maxWithout+s.maxWith,e=r.filter(function(t){return"category"===t.type&&-1===t.variable.indexOf("PE")});d3.select("#sidebar-charts").selectAll("categories").data(e).enter().append("div").attr("id",function(t){return t.variable}).each(function(t){t.variable!==t.group&&document.getElementById(t.group).appendChild(this)});var n=r.filter(function(t){return"category"!==t.type&&-1===t.variable.indexOf("PE")});s.nested=d3.nest().key(function(t){return t.group}).entries(n),s.nested.forEach(function(e,n,a){var i=n<a.length-1?"0 0 100 12":"0 0 100 22",o=6,u=0,c=100-u-0;s.scale=d3.scaleLinear().domain([0,t]).range([0,c]);var l=d3.select("#"+e.key).append("svg").attr("width","100%").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1").attr("viewBox",i),f=l.append("defs").append("pattern").attr("id","hash4_4").attr("width","4").attr("height","4").attr("patternUnits","userSpaceOnUse").attr("patternTransform","rotate(60)");f.append("rect").attr("width","2").attr("height","4").attr("transform","translate(0,0)").attr("fill","#2b526f"),f.append("rect").attr("width","2").attr("height","4").attr("transform","translate(2,0)").attr("fill","#3f98da");var p=l.append("g").attr("transform","translate("+u+","+o+")");if(p.append("text").text(r.find(function(t){return t.variable===e.values.find(function(t){return"without"===t.type}).group}).label).attr("font-size",5.5).attr("text-anchor","middle").attr("x",s.scale(s.maxWithout)).attr("transform","translate(0,-2)").classed("category-label",!0).on("mouseover",s.showDefinition).on("mouseleave",s.hideDefinition),s[e.key+"-without"]=p.selectAll("without").data([e.values.find(function(t){return"without"===t.type})]).enter().append("rect").classed("without",!0).attr("transform",function(){return"translate("+s.scale(s.maxWithout)+", 0)"}).attr("height",4).on("mouseleave",s.hideData),void 0!==e.values.find(function(t){return"private"===t.type})?(s[e.key+"-priv"]=p.selectAll("private").data([e.values.find(function(t){return"private"===t.type})]).enter().append("rect").classed("private",!0).attr("transform",function(){return"translate("+s.scale(s.maxWithout)+", 0)"}).attr("height",4).on("mouseleave",s.hideData),s[e.key+"-pub"]=p.selectAll("public").data([e.values.find(function(t){return"public"===t.type})]).enter().append("rect").classed("public",!0).attr("height",4).on("mouseleave",s.hideData)):s[e.key+"-unspecified"]=p.selectAll("unspecified").data([e.values.find(function(t){return"without"===t.type})]).enter().append("rect").classed("unspecified",!0).attr("transform",function(){return"translate("+s.scale(s.maxWithout)+", 0)"}).attr("height",4).attr("fill","url(#hash4_4)").on("mouseleave",s.hideData),n===a.length-1){var d=p.append("g").classed("x-axis",!0).attr("transform","translate(0,11)");d.append("text").attr("transform","translate("+s.scale(s.maxWithout+.5*s.maxWith)+", 5)").attr("font-size","5").attr("text-anchor","middle").text("with insurance"),d.append("text").attr("transform","translate("+s.scale(.5*s.maxWithout)+", 5)").attr("font-size","5").attr("text-anchor","middle").text("without insurance");for(var P=function(t){d.append("text").attr("transform","translate("+s.scale(s.maxWithout+25*t)+", 0)").attr("font-size","5").attr("text-anchor","middle").text(function(){return 0===t?25*t+"%":25*t}),t>0&&4*t<s.maxWithout&&d.append("text").attr("transform","translate("+s.scale(s.maxWithout-25*t)+", 0)").attr("font-size","5").attr("text-anchor","middle").text(25*t)},h=0;h<4;h++)P(h)}})}(s.maxWithout,s.maxWith),this.chartsAreCreated=!0,function(){var t=d3.select("#sidebar-charts").append("svg").classed("legend",!0).attr("width","292px").attr("height","44px"),e=t.append("defs").append("pattern").attr("id","hash4_4").attr("width","4").attr("height","4").attr("patternUnits","userSpaceOnUse").attr("patternTransform","rotate(60)");e.append("rect").attr("width","2").attr("height","4").attr("transform","translate(0,0)").attr("fill","#2b526f"),e.append("rect").attr("width","2").attr("height","4").attr("transform","translate(2,0)").attr("fill","#3f98da");var n=t.append("g").attr("transform","translate(-114,0)").selectAll("legend-item").data([{text:"None",class:"without"},{text:"Private",class:"private"},{text:"Public",class:"public"},{text:"Not specified",class:"unspecified",fill:"url(#hash4_4)"}]).enter().append("g").attr("transform",function(t,e){return"translate("+(70*e+146)+", 10)"});n.append("rect").attr("class",function(t){return t.class}).attr("width",15).attr("height",15).attr("fill",function(t){if(void 0!==t.fill)return t.fill}),n.append("text").attr("transform","translate(7,30)").attr("text-anchor","middle").text(function(t){return t.text})}(),a()}},showDefinition:function(t){s.definitionsLeft.datum(t),s.fadeInHTML.call(s.definitionsLeft,function(t){return t.description?'<p class="definition-name">'+t.name+' <span class="ACS-variable">('+t.variable+')</span></p><p class="definition-description">'+t.description+"</p>":'<p class="definition-name">'+t.name+'</p> <span class="ACS-variable">('+t.variable+")</span>"})},hideDefinition:function(){s.fadeInHTML.call(s.definitionsLeft,function(){return""})},showData:function(t,e,n,a){var i=a?s.definitionsLeft:s.definitionsRight;i.datum(t),s.fadeInHTML.call(i,function(t){return n?"<p>"+t.label+":<br />"+e+"% ("+d3.format(",")(n)+" people)</p>":"<p>"+t.label+":<br />"+e+"%</p>"})},hideData:function(){s.fadeInHTML.call(s.definitionsLeft,function(){return""}),s.fadeInHTML.call(s.definitionsRight,function(){return""})}},u={controlState:function(){function t(){}var e={};return{logState:t,getState:function(t){return void 0!==e[t]?e[t][0]:void 0},getPreviousState:function(t){return void 0!==e[t]&&void 0!==e[t][1]?e[t][1]:void 0},setState:function(n,a){void 0===e[n]?(e[n]=[a],PubSub.publish(n,a),t()):("string"==typeof a?e[n][0]!==a:!Array.isArray(a)||!Array.isArray(e[n][0])||!a.compare(e[n][0]))&&(e[n].unshift(a),PubSub.publish(n,a),t(),e[n].length>2&&(e[n].length=2))}}}(),controlSubs:function(){function t(t,e){var n="f"+e.toString().hashCode();return{token:"sub"+(t+e).hashCode(),fn:n}}var e={};return{logSubs:function(){},setSubs:function(n){n.forEach(function(n){var a=n[0],i=n[1],r=t(a,i);if(void 0===e[r.fn]&&(e[r.fn]={}),void 0!==e[r.fn][a])throw"Subscription token is already in use.";e[r.fn][a]=PubSub.subscribe(a,i)})},cancelSub:function(n,a){var i=t(n,a);if(void 0===e[i.fn]||void 0===e[i.fn][n])throw"Subscription does not exist.";PubSub.unsubscribe(e[i.fn][n]),delete e[i.fn][n],0===Object.keys(e[i.fn]).length&&delete e[i.fn]},cancelFunction:function(n){var a=t("",n);PubSub.unsubscribe(n),delete e[a.fn]}}}(),init:function(){var t=this;this.setRezizeWatcher(),o.init(),this.promises={maps:[]},i.forEach(function(e,n){t.promises.maps[n]=new Promise(function(t){o.initializeMap(e,n,t)})}),this.promises.stateData=this.returnACSData("https://api.census.gov/data/2015/acs/acs5/profile?get=DP03_0099PE,NAME&for=state:*&key=",null,!1),this.promises.countyData=this.returnACSData("https://api.census.gov/data/2015/acs/acs5/profile?get=DP03_0099PE,NAME&for=county:*&key=",null,!1),this.promises.USDetails=this.returnACSData("https://api.census.gov/data/2015/acs/acs5/profile?get=DP03_0095E,DP03_0095PE,DP03_0096E,DP03_0096PE,DP03_0097E,DP03_0097PE,DP03_0098E,DP03_0098PE,DP03_0099E,DP03_0099PE,DP03_0100E,DP03_0100PE,DP03_0101E,DP03_0101PE,DP03_0102E,DP03_0102PE,DP03_0103E,DP03_0103PE,DP03_0104E,DP03_0104PE,DP03_0105E,DP03_0105PE,DP03_0106E,DP03_0106PE,DP03_0107E,DP03_0107PE,DP03_0108E,DP03_0108PE,DP03_0109E,DP03_0109PE,DP03_0110E,DP03_0110PE,DP03_0111E,DP03_0111PE,DP03_0112E,DP03_0112PE,DP03_0113E,DP03_0113PE,DP03_0114E,DP03_0114PE,DP03_0115E,DP03_0115PE,DP03_0116E,DP03_0116PE,DP03_0117E,DP03_0117PE,DP03_0118E,DP03_0118PE,NAME&for=us:*&key=",null,!1),Promise.all([this.promises.stateData]).then(function(t){s.initializeDropdown(t[0])}),Promise.all([this.promises.stateData,this.promises.countyData,Promise.all(this.promises.maps)]).then(function(t){o.setup(t)}),s.getStateDetails()},setRezizeWatcher:function(){var t=null;window.onresize=function(){null!=t&&clearTimeout(t),t=setTimeout(function(){o.checkMapViewAspect(),o.resizeMaps()},200)}},returnACSData:function(t,e,n){var a=this;return new Promise(function(i,r){d3.json(t+"3a82a0bf1219fb2fb0962763bb1582c5951f8566",function(t,o){t&&r(t),i(a.returnKeyValues(o,e,n))})})},returnData:function(t){return new Promise(function(e,n){d3.json(t,function(t,a){t&&n(t),e(a)})})},returnKeyValues:function(t,e,n){var a=t.slice(1).map(function(e){return e.reduce(function(e,a,i){return e[t[0][i]]=!0===n?isNaN(+a)?a:+a:a,e},{})});return e?"string"==typeof e?d3.nest().key(function(t){return t[e]}).object(a):"function"==typeof e?d3.nest().key(function(t){return e(t)}).object(a):void 0:a}},c=u.controlState.setState,l=u.controlState.getState,f=u.controlState.getPreviousState,p=u.controlSubs.setSubs;String.prototype.hashCode=function(){var t,e,n=0;if(0===this.length)return n;for(t=0,e=this.length;t<e;t++)n=(n<<5)-n+this.charCodeAt(t),n|=0;return n},u.init()}()},{}]},{},[1]);